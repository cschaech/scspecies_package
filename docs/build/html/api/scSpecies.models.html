

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>scspecies.models module &mdash; scspecies Documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css?v=572af1d6" />
      <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=01f34227"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/thebelab-helper.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="scspecies.plot module" href="scspecies.plot.html" />
    <link rel="prev" title="scspecies.preprocessing module" href="scspecies.preprocessing.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            scspecies
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Navigation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips.html">Tips to fit scSpecies</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">scspecies</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="api.html">API Reference</a></li>
      <li class="breadcrumb-item active">scspecies.models module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/scspecies.models.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="scspecies-models-module">
<h1>scspecies.models module<a class="headerlink" href="#scspecies-models-module" title="Link to this heading"></a></h1>
<p>The main scSpecies class facilitating architecture alignment and subsequent analyses.</p>
<dl class="py class">
<dt class="sig sig-object py" id="scspecies.models.scSpecies">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">scspecies.models.</span></span><span class="sig-name descname"><span class="pre">scSpecies</span></span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The scSpecies cross-species architecture alignment framework built on scVI.</p>
<p>This class implements end-to-end preprocessing, variational encoding, decoding, and alignment
for a “context” dataset (e.g., mouse) and a “target” dataset (e.g., human). It supports:</p>
<ul class="simple">
<li><p>Training scVI models on context and target (latent or intermediate alignment).</p></li>
<li><p>Library size encoding and negative-binomial / zero-inflated NB likelihoods.</p></li>
<li><p>Establishing a direct correspondece between traget can context cell via a likelihood-based similarity measure</p></li>
<li><p>Latent-space nearest-neighbor label transfer based on the similarity measure.</p></li>
<li><p>Log-fold-change computation of homologous genes.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> (<em>str</em>) – PyTorch device identifier (‘cpu’, ‘mps’ or ‘cuda’).</p></li>
<li><p><strong>mdata</strong> (<em>mu.MuData</em>) – Multi-modal container holding context and target AnnData objects, set up by the <cite>create_mdata</cite> class.</p></li>
<li><p><strong>directory</strong> (<em>str</em>) – Base path for saving model parameters, data, and figures.</p></li>
<li><p><strong>random_seed</strong> (<em>int</em><em>, </em><em>default=369963</em>) – Seed for NumPy and PyTorch RNGs.</p></li>
<li><p><strong>context_key</strong> (<em>str</em><em>, </em><em>default='mouse'</em>) – Key in <cite>mdata.mod</cite> for the context dataset.</p></li>
<li><p><strong>target_key</strong> (<em>str</em><em>, </em><em>default='human'</em>) – Key in <cite>mdata.mod</cite> for the target dataset.</p></li>
<li><p><strong>context_optimizer</strong> (<em>torch.optim.Optimizer classes</em>) – Optimizer constructors for context and target models.</p></li>
<li><p><strong>target_optimizer</strong> (<em>torch.optim.Optimizer classes</em>) – Optimizer constructors for context and target models.</p></li>
<li><p><strong>context_hidden_dims_enc_outer</strong> (<em>list</em><em>[</em><em>int</em><em>]</em>) – Hidden layer sizes for the outer encoders.</p></li>
<li><p><strong>target_hidden_dims_enc_outer</strong> (<em>list</em><em>[</em><em>int</em><em>]</em>) – Hidden layer sizes for the outer encoders.</p></li>
<li><p><strong>hidden_dims_enc_inner</strong> (<em>list</em><em>[</em><em>int</em><em>]</em>) – Hidden layer sizes for the inner encoder.</p></li>
<li><p><strong>context_hidden_dims_l_enc</strong> (<em>list</em><em>[</em><em>int</em><em>]</em>) – Hidden layer sizes for the library encoder.</p></li>
<li><p><strong>target_hidden_dims_l_enc</strong> (<em>list</em><em>[</em><em>int</em><em>]</em>) – Hidden layer sizes for the library encoder.</p></li>
<li><p><strong>context_hidden_dims_dec</strong> (<em>list</em><em>[</em><em>int</em><em>]</em>) – Hidden layer sizes for the decoder.</p></li>
<li><p><strong>target_hidden_dims_dec</strong> (<em>list</em><em>[</em><em>int</em><em>]</em>) – Hidden layer sizes for the decoder.</p></li>
<li><p><strong>context_layer_order</strong> (<em>list</em>) – Layer specification lists for <cite>create_structure</cite>.</p></li>
<li><p><strong>target_layer_order</strong> (<em>list</em>) – Layer specification lists for <cite>create_structure</cite>.</p></li>
<li><p><strong>b_s</strong> (<em>int</em><em>, </em><em>default=128</em>) – Batch size for training and inference.</p></li>
<li><p><strong>context_data_distr</strong> (<em>{'nb'</em><em>, </em><em>'zinb'}</em>) – Observation models for counts.</p></li>
<li><p><strong>target_data_distr</strong> (<em>{'nb'</em><em>, </em><em>'zinb'}</em>) – Observation models for counts.</p></li>
<li><p><strong>lat_dim</strong> (<em>int</em><em>, </em><em>default=10</em>) – Dimensionality of the latent space.</p></li>
<li><p><strong>context_dispersion</strong> (<em>{'dataset'</em><em>, </em><em>'batch'</em><em>, </em><em>'cell'}</em>) – Dispersion parameterization strategy.</p></li>
<li><p><strong>target_dispersion</strong> (<em>{'dataset'</em><em>, </em><em>'batch'</em><em>, </em><em>'cell'}</em>) – Dispersion parameterization strategy.</p></li>
<li><p><strong>alignment</strong> (<em>{'inter'</em><em>, </em><em>'latent'}</em>) – Alignment mode between context and target. Either at the outer encoder output space or at the latent space.</p></li>
<li><p><strong>k_neigh</strong> (<em>int</em><em>, </em><em>default=25</em>) – Number of neighbors candidates for alignment from the data-level NNS.</p></li>
<li><p><strong>top_percent</strong> (<em>float</em><em>, </em><em>default=20</em>) – Percentile cutoff for selecting top-agreement neighbors.</p></li>
<li><p><strong>context_beta_*</strong> (<em>floats and ints</em>) – Schedules for KL and alignment weight ramps.</p></li>
<li><p><strong>target_beta_*</strong> (<em>floats and ints</em>) – Schedules for KL and alignment weight ramps.</p></li>
<li><p><strong>eta_*</strong> (<em>floats and ints</em>) – Schedules for KL and alignment weight ramps.</p></li>
<li><p><strong>use_lib_enc</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Whether to include a library-size encoder.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">device,</span> <span class="pre">mdata,</span> <span class="pre">directory,</span> <span class="pre">random_seed=369963,</span> <span class="pre">context_key='mouse',</span> <span class="pre">target_key='human',</span> <span class="pre">context_optimizer=&lt;class</span> <span class="pre">'torch.optim.adam.Adam'&gt;,</span> <span class="pre">target_optimizer=&lt;class</span> <span class="pre">'torch.optim.adam.Adam'&gt;,</span> <span class="pre">context_hidden_dims_enc_outer=[300],</span> <span class="pre">target_hidden_dims_enc_outer=[300],</span> <span class="pre">hidden_dims_enc_inner=[200],</span> <span class="pre">context_hidden_dims_l_enc=[200],</span> <span class="pre">target_hidden_dims_l_enc=[200],</span> <span class="pre">context_hidden_dims_dec=[200,</span> <span class="pre">300],</span> <span class="pre">target_hidden_dims_dec=[200,</span> <span class="pre">300],</span> <span class="pre">lat_dim=10,</span> <span class="pre">context_layer_order=['linear',</span> <span class="pre">'layer_norm',</span> <span class="pre">('act',</span> <span class="pre">ReLU()),</span> <span class="pre">('dropout',</span> <span class="pre">0.1)],</span> <span class="pre">target_layer_order=['linear',</span> <span class="pre">'layer_norm',</span> <span class="pre">('act',</span> <span class="pre">ReLU()),</span> <span class="pre">('dropout',</span> <span class="pre">0.1)],</span> <span class="pre">use_lib_enc=True,</span> <span class="pre">b_s=128,</span> <span class="pre">context_data_distr='zinb',</span> <span class="pre">target_data_distr='zinb',</span> <span class="pre">context_dispersion='batch',</span> <span class="pre">target_dispersion='batch',</span> <span class="pre">alignment='inter',</span> <span class="pre">k_neigh=25,</span> <span class="pre">top_percent=20,</span> <span class="pre">context_beta_start=0.1,</span> <span class="pre">context_beta_max=1,</span> <span class="pre">context_beta_epochs_raise=10,</span> <span class="pre">target_beta_start=0.1,</span> <span class="pre">target_beta_max=1,</span> <span class="pre">target_beta_epochs_raise=10,</span> <span class="pre">eta_start=10,</span> <span class="pre">eta_max=25,</span> <span class="pre">eta_epochs_raise=10</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.__init__" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.compute_logfold_change">
<span class="sig-name descname"><span class="pre">compute_logfold_change</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eval_cell_types</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lfc_delta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_cell_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidence_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.9</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.compute_logfold_change"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.compute_logfold_change" title="Link to this definition"></a></dt>
<dd><p>Monte Carlo estimation of per-gene Log2-fold-changes and associated probabilities.</p>
<p>For each specified cell type (or the intersection of context/target types), samples
from the scVI posterior, computes the ratio of target vs. context expression for each
homologous gene, and aggregates:
- Median Log2-fold-change (on normalized decoder space),
- Probability(abs(Log2Fc) &gt; lfc_delta),
- Mean gene expression on normalized decoder space and NB parameter space.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>eval_cell_types</strong> (<em>sequence</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Cell types to include; defaults to the intersection of context and target types.</p></li>
<li><p><strong>eps</strong> (<em>float</em><em>, </em><em>default=1e-6</em>) – Small constant added before log to prevent small gene expression patterns from returning large LFC values.</p></li>
<li><p><strong>lfc_delta</strong> (<em>float</em><em>, </em><em>default=1</em>) – Threshold for computing the probability of large fold-changes.</p></li>
<li><p><strong>target_cell_key</strong> (<em>str</em><em> or </em><em>None</em>) – Column name in <cite>.obs</cite> specifying inferred cell type labels for the target dataset;</p></li>
<li><p><strong>samples</strong> (<em>int</em><em>, </em><em>default=50000</em>) – Total number of Monte Carlo draws per cell.</p></li>
<li><p><strong>b_s</strong> (<em>int</em><em>, </em><em>default=128</em>) – Batch size for sampling iterations.</p></li>
<li><p><strong>confidence_level</strong> (<em>float</em><em>, </em><em>default=0.9</em>) – Outlier filtering threshold for latent space.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>lfc_dict</strong> – Dictionary with cell-wise data frames containing the keys:
- ‘rho_median_context’ : Median context normalized gene expression,
- ‘mu_median_context’ : Median context expected value gene expression,
- ‘rho_median_target’ : Median target normalized gene expression,
- ‘mu_median_target’ : Median target expected value gene expression,
- ‘lfc’ : Median Log2 fold-change of the relative expression parameter rho,
- ‘p’ : Probability of Log2 fold-change values greater than lfc_delta,
- ‘lfc_rand’ : Median Log2 fold-change of the relative expression parameter rho on permuted data,
- ‘p_rand’ : Probability of Log2 fold-change values greater than lfc_delta  on permuted data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict of str to pd.Dataframe</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_outer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encoder_inner</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lib_encoder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.encode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.encode" title="Link to this definition"></a></dt>
<dd><p>Encode data into biological and/or library latent variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>Tensor</em><em>, </em><em>shape</em><em> (</em><em>n_cells</em><em>, </em><em>n_genes</em><em>)</em>) – Raw or log-transformed count matrix.</p></li>
<li><p><strong>s</strong> (<em>Tensor</em><em>, </em><em>shape</em><em> (</em><em>n_cells</em><em>, </em><em>n_batches</em><em>)</em>) – One-hot encoded batch labels.</p></li>
<li><p><strong>encoder_outer</strong> (<em>nn.Module</em><em>, </em><em>optional</em>) – Outer encoder; if None, skips z/inter outputs.</p></li>
<li><p><strong>encoder_inner</strong> (<em>nn.Module</em><em>, </em><em>optional</em>) – Inner encoder; if None, skips z/inter outputs.</p></li>
<li><p><strong>lib_encoder</strong> (<em>nn.Module</em><em>, </em><em>optional</em>) – Library encoder; if None, skips l_mu/l_sig outputs.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>], <code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>Depending on provided encoders</em></p></li>
<li><p>(z_mu, z_sig, inter) if <cite>lib_encoder</cite> is None.</p></li>
<li><p>(l_mu, l_sig) if only <cite>lib_encoder</cite> is provided.</p></li>
<li><p><em>(z_mu, z_sig, inter, l_mu, l_sig) if all provided.</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.generate_homologous_samples">
<span class="sig-name descname"><span class="pre">generate_homologous_samples</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_cell_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">128</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidence_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.9</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.generate_homologous_samples"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.generate_homologous_samples" title="Link to this definition"></a></dt>
<dd><p>Decode homologous normalized expression profiles for context and target species by Monte Carlo sampling.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_cell_key</strong> (<em>str</em><em> or </em><em>None</em>) – Column name in <cite>.obs</cite> specifying inferred cell type labels for the target dataset;</p></li>
<li><p><strong>samples</strong> (<em>int</em><em>, </em><em>default=5000</em>) – Total number of decoded samples to return per cell type.</p></li>
<li><p><strong>b_s</strong> (<em>int</em><em>, </em><em>default=128</em>) – Batch size for decoding iterations.</p></li>
<li><p><strong>confidence_level</strong> (<em>float</em><em>, </em><em>default=0.9</em>) – Quantile threshold used in <cite>filter_outliers</cite> to remove extreme latent embeddings.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>], <code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>target_rho_dict</strong> (<em>dict of str to ndarray of shape (samples, genes)</em>) – Decoded normalized expression (<cite>rho</cite>) for shared cell types in the target species.</p></li>
<li><p><strong>context_rho_dict</strong> (<em>dict of str to ndarray of shape (samples, genes)</em>) – Decoded normalized expression (<cite>rho</cite>) for shared cell types in the context species.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.get_representation">
<span class="sig-name descname"><span class="pre">get_representation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">eval_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_intermediate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_libsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.get_representation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.get_representation" title="Link to this definition"></a></dt>
<dd><p>Compute and store biological latent and/or library latent representations for a dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>eval_model</strong> (<em>{'context'</em><em>,</em><em>'target'}</em>) – Which dataset to encode.</p></li>
<li><p><strong>save_intermediate</strong> (<em>bool</em><em>, </em><em>default=False</em>) – If True, store the outer encoder output in <cite>.obsm[‘inter’]</cite>.</p></li>
<li><p><strong>save_libsize</strong> (<em>bool</em><em>, </em><em>default=False</em>) – If True, store library mean/log-std in <cite>.obsm[‘l_mu’]</cite>/<cite>[‘l_sig’]</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.initialize">
<span class="sig-name descname"><span class="pre">initialize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">initialize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'both'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.initialize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.initialize" title="Link to this definition"></a></dt>
<dd><p>Instantiate or reinstantiate context and/or target encoder and decoder modules.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>initialize</strong> (<em>{'context'</em><em>, </em><em>'context_decoder'</em><em>, </em><em>'target'</em><em>, </em><em>'both'}</em><em>, </em><em>default='both'</em>) – Which sub-model(s) to initialize.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.label_transfer">
<span class="sig-name descname"><span class="pre">label_transfer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">context_obs_keys</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">top_neigh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_sim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.label_transfer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.label_transfer" title="Link to this definition"></a></dt>
<dd><p>Assign context-derived labels via similarity scores to each target cell by majority vote among its top candidates.</p>
<p>For each observation key in <cite>context_obs_keys</cite>, finds the <cite>top_neigh</cite> most similar context
cells (based on decoder likelihood in latent space), takes the most frequent label among
those neighbors, and writes it into <cite>self.mdata.mod[target_key].obs[‘pred_sim_&lt;obs_key&gt;’]</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>context_obs_keys</strong> (<em>sequence</em><em> of </em><em>str</em>) – One or more keys in <cite>self.mdata.mod[context_key].obs</cite> whose values to transfer.</p></li>
<li><p><strong>top_neigh</strong> (<em>int</em><em>, </em><em>default=25</em>) – Number of nearest neighbors to consider for the majority vote.</p></li>
<li><p><strong>write_sim</strong> (<em>bool</em><em>, </em><em>default=False</em>) – If True, also stores raw similarity scores and neighbor indices in
<cite>self.mdata.mod[target_key].obsm[‘similarities’]</cite> and
<cite>[‘similarities_ind’]</cite>.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">models</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'both'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.load" title="Link to this definition"></a></dt>
<dd><p>Load previously saved configs, optimizers, and weights.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>models</strong> (<em>{'context'</em><em>,</em><em>'target'</em><em>,</em><em>'both'}</em>)</p></li>
<li><p><strong>save_key</strong> (<em>str</em>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.ret_pred_df">
<span class="sig-name descname"><span class="pre">ret_pred_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pred_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_label_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context_label_key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.ret_pred_df"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.ret_pred_df" title="Link to this definition"></a></dt>
<dd><p>Compute a normalized confusion matrix (%) and balanced accuracy for label transfer.</p>
<p>This evaluates how well the predicted context-derived labels match the true labels
on the target dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pred_key</strong> (<em>str</em>) – Key in <cite>self.mdata.mod[target_key].obs</cite> under which predicted labels are stored.</p></li>
<li><p><strong>target_label_key</strong> (<em>str</em>) – Key in <cite>self.mdata.mod[target_key].obs</cite> for the ground-truth labels.</p></li>
<li><p><strong>context_label_key</strong> (<em>str</em>) – Key in <cite>self.mdata.mod[context_key].obs</cite> for the reference context labels.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – Confusion matrix (in percent) with
- index: sorted labels of <cite>target_label_key</cite>,
- columns: sorted labels of <cite>context_label_key</cite>,
- values: percentage of cells with true label = row and predicted label = column.</p></li>
<li><p><strong>bas</strong> (<em>float</em>) – Balanced accuracy score computed only over the subset of cells whose true labels
also appear in the context set.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.return_similarity_df">
<span class="sig-name descname"><span class="pre">return_similarity_df</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_sample_targ</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_sample_cont</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'none'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.return_similarity_df"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.return_similarity_df" title="Link to this definition"></a></dt>
<dd><p>Compute and return similarity scores between target and context cell types
by sampling from latent cell type ditributions and calculating likelihood differences.
Computes the modal value of the resulting distribution as similarity score.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>max_sample_targ</strong> (<em>int</em><em>, </em><em>default=2000</em>) – Number of samples from the target cell types.</p></li>
<li><p><strong>max_sample_cont</strong> (<em>int</em><em>, </em><em>default=50</em>) – Number of samples from the context cell types per target cell.</p></li>
<li><p><strong>scale</strong> (<em>{'min_max'</em><em>, </em><em>'max'</em><em>, </em><em>'none'}</em><em>, </em><em>default='max'</em>) – Scaling strategy across rows: min-max normalization or max-based inversion.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>df</strong> – Similarity scores with
- index: target cell types,
- columns: context cell types.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">models</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'both'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.save" title="Link to this definition"></a></dt>
<dd><p>Serialize model configuration, optimizers, and context and/or target scVI weights to disk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>models</strong> (<em>{'context'</em><em>, </em><em>'target'</em><em>, </em><em>'both'}</em>) – Which sub-models to save.</p></li>
<li><p><strong>save_key</strong> (<em>str</em>) – Suffix for filenames.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.save_mdata">
<span class="sig-name descname"><span class="pre">save_mdata</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">save_key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.save_mdata"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.save_mdata" title="Link to this definition"></a></dt>
<dd><p>Write the assembled MuData object to <cite>.h5mu</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>save_key</strong> (<em>str</em>) – Suffix for the data filename.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.similarity_metric">
<span class="sig-name descname"><span class="pre">similarity_metric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_ind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context_ind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b_sc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">display</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.similarity_metric"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.similarity_metric" title="Link to this definition"></a></dt>
<dd><p>Compute negative log-likelihood based similarity scores for target and context cells specified by their indices.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_ind</strong> (<em>array</em><em> of </em><em>integers</em>) – Traget cell indices in <cite>self.mdata[target_key].X</cite> shape (n_target, 1)</p></li>
<li><p><strong>context_ind</strong> (<em>array</em><em> of </em><em>integers</em>) – Context cell neighbors in <cite>self.mdata[context_key].X</cite> shape (n_target, k).
Calculates the similarity of k candidates for a specific entry in the first axis.</p></li>
<li><p><strong>b_s</strong> (<em>int</em><em>, </em><em>optional</em>) – Batch size for target.</p></li>
<li><p><strong>b_sc</strong> (<em>int</em><em>, </em><em>optional</em>) – Chunk size for context neighbors.</p></li>
<li><p><strong>display</strong> (<em>bool</em>) – If True, prints progress.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>similarities</strong> – Contains the similarity scores between the context cells and their k candidates, shape (n_target, k).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.similarity_metric_on_latent_space">
<span class="sig-name descname"><span class="pre">similarity_metric_on_latent_space</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">precompute_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.similarity_metric_on_latent_space"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.similarity_metric_on_latent_space" title="Link to this definition"></a></dt>
<dd><p>Compute similarity scores for the whole context and target dataset pairs.
Either for a precomputed set of neighbors based on the results of a latent spce neighborhood search to speed up computation
or the whole dataset. (Should only be done for small datasets.)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>precompute_neighbors</strong> (<em>bool</em>) – If True precomutes a set of 250 euclidean neighbors on the aligned latent space.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>similarities</strong> (<em>ndarray of shape (target.n_obs, 250) or (target.n_obs, context.n_obs)</em>)</p></li>
<li><p><strong>context_ind</strong> (<em>ndarray of shape (target.n_obs, 250) or (target.n_obs, context.n_obs)</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.train_context">
<span class="sig-name descname"><span class="pre">train_context</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raise_beta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_decoder_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.train_context"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.train_context" title="Link to this definition"></a></dt>
<dd><p>Pretrain the context scVI model on the context dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>epochs</strong> (<em>int</em><em>, </em><em>default=40</em>) – Number of training epochs.</p></li>
<li><p><strong>raise_beta</strong> (<em>bool</em><em>, </em><em>default=True</em>) – If True, increase KL weight over initial epochs.</p></li>
<li><p><strong>save_model</strong> (<em>bool</em><em>, </em><em>default=True</em>) – If True, save model parameters after training.</p></li>
<li><p><strong>train_decoder_only</strong> (<em>bool</em><em>, </em><em>default=False</em>) – If True, freeze encoders and train only the decoder.</p></li>
<li><p><strong>save_key</strong> (<em>str</em><em>, </em><em>default=''</em>) – Filename suffix when saving.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.train_target">
<span class="sig-name descname"><span class="pre">train_target</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">40</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raise_beta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raise_eta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.train_target"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.train_target" title="Link to this definition"></a></dt>
<dd><p>Train the target-side scVI model, optionally aligning to context.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>epochs</strong> (<em>int</em><em>, </em><em>default=40</em>) – Number of training epochs.</p></li>
<li><p><strong>save_model</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Save parameters after training.</p></li>
<li><p><strong>raise_beta</strong> (<em>bool</em><em>, </em><em>default=True</em>) – If True, increase KL weight over initial epochs.</p></li>
<li><p><strong>raise_eta</strong> (<em>bool</em><em>, </em><em>default=True</em>) – If True, increase alignment weight over initial epochs.</p></li>
<li><p><strong>save_key</strong> (<em>str</em><em>, </em><em>default=''</em>) – Suffix for saved files.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="scspecies.models.scSpecies.transfer_info">
<span class="sig-name descname"><span class="pre">transfer_info</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_ind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">context_obs_transfer</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#scSpecies.transfer_info"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.scSpecies.transfer_info" title="Link to this definition"></a></dt>
<dd><p>Calculate similarity scores for a specific target cell specified by its index in <cite>self.mdata[target_key].X</cite>
and all context cells. Transfers labels specifies in context_obs_transfer. Returns a dataframe
of context cells sorted by similarity scores.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>target_ind</strong> (<em>int</em>) – Target cell indices.</p></li>
<li><p><strong>context_obs_transfer</strong> (<em>str</em><em> or </em><em>List</em><em> of </em><em>str</em>) – Observation key from context dataset to return as columns in the outpt (e.g., ‘cell_type’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Context labels, source indices, and similarity scores with the specified target cell.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>DataFrame</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="scspecies.models.neighbors_workaround">
<span class="sig-prename descclassname"><span class="pre">scspecies.models.</span></span><span class="sig-name descname"><span class="pre">neighbors_workaround</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_rep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'euclidean'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/scspecies/models.html#neighbors_workaround"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#scspecies.models.neighbors_workaround" title="Link to this definition"></a></dt>
<dd><p>Compute the k-nearest-neighbors graph manually and store it in <cite>adata</cite>.
Replacement for sc.pp.neighbors on M1/M2 chips to avoid kernel crashes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>ad.AnnData</em>) – Annotated data object.</p></li>
<li><p><strong>use_rep</strong> (<em>str</em>) – Key in <cite>adata.obsm</cite> to use for neighbor search (e.g. ‘X_pca’),
or None to use <cite>adata.X</cite>.</p></li>
<li><p><strong>n_neighbors</strong> (<em>int</em>) – Number of nearest neighbors to use.</p></li>
<li><p><strong>metric</strong> (<em>str</em><em> or </em><em>None</em>) – Distance metric to use (default ‘euclidean’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>The same <cite>adata</cite>, with:</dt><dd><ul class="simple">
<li><p>obsp[‘distances’]       : sparse matrix of neighbor distances</p></li>
<li><p>obsp[‘connectivities’]  : sparse binary connectivity matrix</p></li>
<li><p>uns[‘neighbors’]        : dict of params &amp; key names</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>AnnData</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="scspecies.preprocessing.html" class="btn btn-neutral float-left" title="scspecies.preprocessing module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="scspecies.plot.html" class="btn btn-neutral float-right" title="scspecies.plot module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Clemens Schächter.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>